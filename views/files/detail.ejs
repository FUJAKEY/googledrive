<%- include('../partials/layout-head'); %>
<section class="file-detail">
  <header class="detail-header">
    <div>
      <h1><%= file.original_name %></h1>
      <p class="text-muted">Загружен: <%= file.formattedDate %></p>
    </div>
    <% if (isOwner) { %>
      <form method="post" action="/files/<%= file.id %>/delete" onsubmit="return confirm('Удалить файл без возможности восстановления?');">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
        <button type="submit" class="btn btn-danger">Удалить</button>
      </form>
    <% } %>
  </header>
  <div class="detail-grid">
    <div class="detail-card">
      <span class="detail-title">Классификация</span>
      <span class="badge" data-level="<%= file.classification %>"><%= classificationMatrix[file.classification].label %></span>
      <p class="text-muted"><%= classificationMatrix[file.classification].description %></p>
    </div>
    <div class="detail-card">
      <span class="detail-title">Размер</span>
      <p><%= file.formattedSize %></p>
      <span class="detail-title">MIME</span>
      <p><%= file.mime_type %></p>
    </div>
    <div class="detail-card">
      <span class="detail-title">Описание</span>
      <p><%= file.description || 'Не задано' %></p>
    </div>
  </div>
  <% if (isOwner) { %>
    <section class="share-section">
      <h2>Управление доступом</h2>
      <form method="post" action="/files/<%= file.id %>/share" class="form-inline">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
        <input type="email" name="email" placeholder="email@company.com" required>
        <select name="permission">
          <option value="viewer">Просмотр</option>
          <option value="editor">Редактирование</option>
        </select>
        <button type="submit" class="btn">Поделиться</button>
      </form>
      <div class="share-list">
        <% if (shares.length === 0) { %>
          <p class="text-muted">Доступы не настроены.</p>
        <% } %>
        <% shares.forEach((share) => { %>
          <div class="share-item">
            <div>
              <strong><%= share.target_email %></strong>
              <span class="tag"><%= share.permission %></span>
            </div>
            <form method="post" action="/shares/<%= share.id %>/delete">
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <input type="hidden" name="fileId" value="<%= file.id %>">
              <button type="submit" class="btn btn-text">Отозвать</button>
            </form>
          </div>
        <% }); %>
      </div>
    </section>
  <% } %>
</section>
<%- include('../partials/layout-foot'); %>
