<%- include('../partials/layout-start', { title }) %>
<section class="page-header">
  <div>
    <h1>–ú–æ–π –¥–∏—Å–∫</h1>
    <p class="page-subtitle">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Ñ–∞–π–ª–∞–º–∏ –∏ –ø–∞–ø–∫–∞–º–∏ —Å —É—Å–∏–ª–µ–Ω–Ω–æ–π –∑–∞—â–∏—Ç–æ–π.</p>
  </div>
  <div class="page-actions">
    <a class="btn btn-primary" href="/files/upload?path=<%= encodeURIComponent(currentPath) %>">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</a>
    <button class="btn btn-outline" type="button" data-dialog-open="create-folder">–ù–æ–≤–∞—è –ø–∞–ø–∫–∞</button>
  </div>
</section>
<%- include('../partials/breadcrumbs', { breadcrumbs }) %>
<section class="stats">
  <article class="stat-card">
    <h2>–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤</h2>
    <p class="stat-value"><%= stats.totalFiles %></p>
    <p class="stat-meta">–ó–∞–≥—Ä—É–∂–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –º–µ–¥–∏–∞–∫–æ–Ω—Ç–µ–Ω—Ç–∞.</p>
  </article>
  <article class="stat-card">
    <h2>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ</h2>
    <p class="stat-value"><%= stats.readableSize %></p>
    <p class="stat-meta">–õ–∏–º–∏—Ç –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ ‚Äî <%= uploadLimitMb %> –ú–ë.</p>
  </article>
  <article class="stat-card">
    <h2>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
    <% if (recentActivity && recentActivity.length) { %>
    <p class="stat-value"><%= recentActivity[0].level %></p>
    <p class="stat-meta">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: <%= recentActivity[0].formattedTimestamp %></p>
    <% } else { %>
    <p class="stat-value">‚Äî</p>
    <p class="stat-meta">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.</p>
    <% } %>
  </article>
</section>
<section class="file-panel">
  <header class="panel-header">
    <h2>–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏</h2>
    <span class="panel-meta">–¢–µ–∫—É—â–∏–π –ø—É—Ç—å: <code><%= currentPath %></code></span>
  </header>
  <div class="file-table" role="table">
    <div class="file-row file-row-header" role="row">
      <span role="columnheader">–ù–∞–∑–≤–∞–Ω–∏–µ</span>
      <span role="columnheader">–¢–∏–ø</span>
      <span role="columnheader">–†–∞–∑–º–µ—Ä</span>
      <span role="columnheader">–°–æ–∑–¥–∞–Ω–æ</span>
      <span role="columnheader" class="actions-col">–î–µ–π—Å—Ç–≤–∏—è</span>
    </div>
    <% if ((!folders || folders.length === 0) && (!files || files.length === 0)) { %>
    <div class="file-row file-row-empty" role="row">
      <span role="cell" colspan="5">–ó–¥–µ—Å—å –ø–æ–∫–∞ –ø—É—Å—Ç–æ. –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª.</span>
    </div>
    <% } %>
    <% folders.forEach((folder) => { %>
    <div class="file-row" role="row">
      <span role="cell" data-label="–ù–∞–∑–≤–∞–Ω–∏–µ">
        <a class="file-link" href="/dashboard?path=<%= encodeURIComponent(folder.fullPath) %>">üìÅ <%= folder.name %></a>
      </span>
      <span role="cell" data-label="–¢–∏–ø">–ü–∞–ø–∫–∞</span>
      <span role="cell" data-label="–†–∞–∑–º–µ—Ä">‚Äî</span>
      <span role="cell" data-label="–°–æ–∑–¥–∞–Ω–æ"><%= new Date(folder.createdAt).toLocaleDateString('ru-RU') %></span>
      <span role="cell" class="actions" data-label="–î–µ–π—Å—Ç–≤–∏—è">
        <form action="/files/<%= folder.id %>/delete" method="post" class="inline-form">
          <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
          <input type="hidden" name="parentPath" value="<%= currentPath %>" />
          <button type="submit" class="btn-icon" title="–£–¥–∞–ª–∏—Ç—å –ø–∞–ø–∫—É" data-confirm="–£–¥–∞–ª–∏—Ç—å –ø–∞–ø–∫—É –≤–º–µ—Å—Ç–µ —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º?">üóë</button>
        </form>
      </span>
    </div>
    <% }); %>
    <% files.forEach((file) => { %>
    <div class="file-row" role="row">
      <span role="cell" data-label="–ù–∞–∑–≤–∞–Ω–∏–µ">
        <a class="file-link" href="/files/<%= file.id %>">üìÑ <%= file.name %></a>
      </span>
      <span role="cell" data-label="–¢–∏–ø">–§–∞–π–ª</span>
      <span role="cell" data-label="–†–∞–∑–º–µ—Ä"><%= file.readableSize %></span>
      <span role="cell" data-label="–°–æ–∑–¥–∞–Ω–æ"><%= new Date(file.createdAt).toLocaleDateString('ru-RU') %></span>
      <span role="cell" class="actions" data-label="–î–µ–π—Å—Ç–≤–∏—è">
        <a class="btn-icon" href="/files/<%= file.id %>/download" title="–°–∫–∞—á–∞—Ç—å">‚¨á</a>
        <form action="/files/<%= file.id %>/delete" method="post" class="inline-form">
          <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
          <input type="hidden" name="parentPath" value="<%= currentPath %>" />
          <button type="submit" class="btn-icon" title="–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª" data-confirm="–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª?">üóë</button>
        </form>
      </span>
    </div>
    <% }); %>
  </div>
</section>
<section class="activity-panel">
  <header class="panel-header">
    <h2>–ù–µ–¥–∞–≤–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h2>
    <a class="panel-link" href="/dashboard/activity">–ü–µ—Ä–µ–π—Ç–∏ –∫ –∂—É—Ä–Ω–∞–ª—É</a>
  </header>
  <% if (recentActivity && recentActivity.length) { %>
  <ul class="activity-list">
    <% recentActivity.forEach((event) => { %>
    <li>
      <span class="activity-time"><%= event.formattedTimestamp %></span>
      <span class="activity-message"><%= event.message %></span>
    </li>
    <% }); %>
  </ul>
  <% } else { %>
  <p class="empty-state">–î–µ–π—Å—Ç–≤–∏–π –ø–æ–∫–∞ –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ.</p>
  <% } %>
</section>
<div class="dialog" id="dialog-create-folder" hidden>
  <div class="dialog-content">
    <h2>–ù–æ–≤–∞—è –ø–∞–ø–∫–∞</h2>
    <form action="/dashboard/folders" method="post" class="form">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
      <input type="hidden" name="parentPath" value="<%= currentPath %>" />
      <div class="form-field">
        <label for="folderName">–ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏</label>
        <input type="text" id="folderName" name="name" required minlength="2" maxlength="60" />
      </div>
      <div class="dialog-actions">
        <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å</button>
        <button type="button" class="btn btn-outline" data-dialog-close>–û—Ç–º–µ–Ω–∞</button>
      </div>
    </form>
  </div>
</div>
<%- include('../partials/layout-end') %>
